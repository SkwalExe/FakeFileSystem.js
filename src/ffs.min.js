class FFS{constructor(){this.Errors={NOT_FOUND:"No such file or directory",NOT_A_REGULAR_FILE:"Not a regular file",NOT_A_DIRECTORY:"Not a directory",FILE_ALREADY_EXISTS:"File or directory already exists",SAME_FILE:"Source and destination are the same",INVALID_NAME:'Invalid file name, must ba at least one character long and cannot contain \\ / : * ? " < > |',ROOT_PROHIBITED:"You cannot perform this operation on the root directory"},this.Result=class{constructor(){this.success=!1,this.error=null,this.result=null,this.errorCause=null}},this.tree=[{type:"directory",name:"/",modified:Date.now(),parent:"/",content:[]}],this.currentDirectory="/",this.getPath=function(r){let t=new this.Result;if("/"==(r=this.simplifyPath(r)))return t.success=!0,t.result=this.tree[0],t;r.startsWith("/")&&(r=r.substring(1));for(var e=this.tree[0],s=r.split("/"),i=0;i<s.length;i++){var n=s[i];if("file"==e.type)return t.error=this.Errors.NOT_A_DIRECTORY,t.errorCause=e.name,t;if(i==s.length-1)return(t.result=e.content.find(r=>r.name==n))?t.success=!0:(t.error=this.Errors.NOT_FOUND,t.errorCause=n),t;if(null==(e=e.content.find(r=>r.name==n)))return t.error=this.Errors.NOT_FOUND,t.errorCause=n,t}},this.fileExists=function(r){return this.getPath(r).success},this.isRegularFile=function(r){let t=this.getPath(r);return!!t.success&&"file"==t.result.type},this.isDir=function(r){let t=this.getPath(r);return!!t.success&&"directory"==t.result.type},this.getFileContent=function(r){let t=new this.Result;return this.isRegularFile(r)?(t.success=!0,t.result=this.getPath(r).result.content,t):this.isDir(r)?(t.error=this.Errors.NOT_A_REGULAR_FILE,t.errorCause=r,t):(t.error=this.Errors.NOT_FOUND,t.errorCause=r,t)},this.getDirContent=function(r){let t=new this.Result;return this.isDir(r)?(t.success=!0,t.result=this.getPath(r).result.content,t):this.isRegularFile(r)?(t.error=this.Errors.NOT_A_DIRECTORY,t.errorCause=r,t):(t.error=this.Errors.NOT_FOUND,t.errorCause=r,t)},this.writeFile=function(r,t,e=!1){let s=new this.Result;if(this.fileExists(r)){if(this.isRegularFile(r)){var i=this.getPath(r).result;return e?i.content+=t:i.content=t,s.success=!0,s.result=i,s}return s.error=this.Errors.NOT_A_REGULAR_FILE,s.errorCause=r,s}return s.success=!0,s.result=this.createFile(r,t),s},this.createFile=function(r,t,e=""){let s=new this.Result;if(!this.isValidName(t))return s.error=this.Errors.INVALID_NAME,s.errorCause=t,s;if(this.fileExists(r+"/"+t))return s.error=this.Errors.FILE_ALREADY_EXISTS,s.errorCause=this.simplifyPath(r+"/"+t),s;var i={type:"file",name:t,modified:Date.now(),parent:r,content:e};return this.fileExists(r)?this.isDir(r)?(this.getPath(r).result.content.push(i),s.success=!0,s.result=i,s):(s.error=this.Errors.NOT_A_DIRECTORY,s.errorCause=r,s):(s.error=this.Errors.NOT_FOUND,s.errorCause=r,s)},this.createDir=function(r,t){let e=new this.Result;if(!this.isValidName(t))return e.error=this.Errors.INVALID_NAME,e.errorCause=t,e;if(this.fileExists(r+"/"+t))return e.error=this.Errors.FILE_ALREADY_EXISTS,e.errorCause=this.simplifyPath(r+"/"+t),e;var s={type:"directory",name:t,modified:Date.now(),parent:r,content:[]};return this.fileExists(r)?this.isDir(r)?(this.getPath(r).result.content.push(s),e.success=!0,e.result=s,e):(e.error=this.Errors.NOT_A_DIRECTORY,e.errorCause=r,e):(e.error=this.Errors.NOT_FOUND,e.errorCause=r,e)},this.simplifyPath=function(r){if(""==(r=r.trim()))return this.currentDirectory;for(;-1!=r.indexOf("//");)r=r.replace(/\/\//g,"/");if("/"==r)return"/";if(r.endsWith("/")&&(r=r.substring(0,r.length-1)),r.startsWith("./")&&(r=this.simplifyPath(this.currentDirectory+"/"+r.substring(2))),r.startsWith("../")){var t=this.getPath(this.currentDirectory).result;r=this.simplifyPath(t.parent+r.substring(2))}if(!r.startsWith("/"))return this.simplifyPath(this.currentDirectory+"/"+r);var e=r.split("/");e=e.filter(r=>""!=r);for(var s=[],i=0;i<e.length;i++){var n=e[i];"."!=n&&(".."!=n?s.push(n):s.length>0&&s.pop())}return"/"+s.join("/")},this.delete=function(r){let t=new this.Result;if("/"==r)return t.error=this.Errors.ROOT_PROHIBITED,t.errorCause=r,t;if(!this.fileExists(r))return t.error=this.Errors.NOT_FOUND,t.errorCause=r,t;var e=this.getPath(r).result,s=this.getPath(e.parent).result;return s.content=s.content.filter(r=>r!=e),t.success=!0,t.result=e,t},this.getParent=function(r){let t=new this.Result;return""==(r=(r=this.simplifyPath(r)).substring(0,r.lastIndexOf("/")))&&(r="/"),this.fileExists(r)?(t.result=this.getPath(r).result,t.success=!0,t):(t.error=this.Errors.NOT_FOUND,t.errorCause=r,t)},this.basename=function(r){return"/"==(r=this.simplifyPath(r))?"/":r.substring(r.lastIndexOf("/")+1)},this.getParentPath=function(r){return"/"==(r=this.simplifyPath(r))?"/":r.substring(0,r.lastIndexOf("/"))},this.getFullPath=function(r){return this.simplifyPath(r.parent+"/"+r.name)},this.isSameFile=function(r,t){return(r=this.simplifyPath(r))==(t=this.simplifyPath(t))},this.isValidName=function(r){return!(!(r=r.trim()).length>0)&&("."!=r&&".."!=r&&!/[\\\/:*?"<>|']/.test(r))},this.copy=function(r,t){let e=new this.Result;if("/"==this.simplifyPath(r))return e.error=this.Errors.ROOT_PROHIBITED,e.errorCause=r,e;if(!this.fileExists(r))return e.error=this.Errors.NOT_FOUND,e.errorCause=r,e;if(this.isSameFile(r,t))return e.error=this.Errors.SAME_FILE,e.errorCause=r,e;var s=this.getPath(r).result;if(this.fileExists(t)){if(!this.isDir(t))return e.error=this.Errors.NOT_A_DIRECTORY,e.errorCause=t,e;if(this.fileExists(t+"/"+s.name))return e.error=this.Errors.FILE_ALREADY_EXISTS,e.errorCause=t+"/"+s.name,e;t=this.getPath(t).result,n={name:s.name,type:s.type,content:s.content,parent:t.parent+"/"+t.name,modified:Date.now()};return t.content.push(n),e.success=!0,e.result=n,e}if(!this.getParent(t).success)return e.error=this.Errors.NOT_FOUND,e.errorCause=this.getParentPath(t),e;if(!this.isDir(this.getParentPath(t)))return e.error=this.Errors.NOT_A_DIRECTORY,e.errorCause=this.getParentPath(t),e;var i=this.getParent(t).result,n={name:this.basename(t),type:s.type,content:s.content,modified:Date.now(),parent:this.getFullPath(i)};return i.content.push(n),e.success=!0,e.result=n,e},this.move=function(r,t){let e=new this.Result;r=this.simplifyPath(r),t=this.simplifyPath(t);let s=this.copy(r,t);return s.success?(this.delete(r),e.success=!0,e.result=s.result,e):(e.error=s.error,e.errorCause=s.errorCause,e)}}}"undefined"!=typeof module&&(module.exports=FFS);